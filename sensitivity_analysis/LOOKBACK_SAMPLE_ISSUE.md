# Lookback Window Length 样本数量问题分析

## 问题描述

在敏感性分析实验中，不同的Lookback window length会导致训练样本数量不一致，这可能会影响实验结果的公平性。

## 问题分析

### 样本数量计算
假设总数据有N个时间点，回看窗口为L小时：

- **可用样本数量** = N - L
- **24小时回看**：N - 24 个样本
- **72小时回看**：N - 72 个样本  
- **120小时回看**：N - 120 个样本
- **168小时回看**：N - 168 个样本

### 具体影响示例
假设总数据有1000个时间点：
- 24小时回看：976个训练样本
- 72小时回看：928个训练样本（减少48个）
- 120小时回看：880个训练样本（减少96个）
- 168小时回看：832个训练样本（减少144个）

## 潜在问题

1. **不公平比较**：不同回看窗口使用不同数量的训练样本
2. **性能偏差**：样本数量差异可能影响模型性能
3. **结果解释困难**：无法确定性能差异是来自回看窗口还是样本数量

## 解决方案

### 方案1：固定样本数量策略（推荐）
- 所有回看窗口使用相同的有效数据范围
- 以最大回看窗口（168小时）为基准
- 确保所有实验使用相同的样本数量

### 方案2：记录实际样本数量
- 在实验结果中明确记录每个实验使用的实际样本数量
- 在分析时考虑样本数量差异的影响

### 方案3：分层分析
- 分别分析样本数量对性能的影响
- 在回看窗口实验中控制样本数量变量

## 实现细节

### 配置修改
在Lookback window length实验配置中添加：
```yaml
fixed_sample_count: true
max_lookback_hours: 168  # 使用最大回看窗口作为基准
```

### 数据处理策略
1. 计算最大回看窗口需要的样本数量
2. 所有回看窗口实验使用相同的有效数据范围
3. 在结果中记录实际使用的样本数量

## 建议

1. **采用固定样本数量策略**：确保实验的公平性
2. **记录样本数量信息**：在结果中明确标注
3. **敏感性分析**：可以单独进行样本数量对性能的影响分析

## 实验设计考虑

### 当前设计
- 单项实验：只改变回看窗口长度
- 其他参数保持默认配置

### 优化后设计
- 单项实验：只改变回看窗口长度
- 其他参数保持默认配置
- **样本数量保持一致**

## 结论

通过采用固定样本数量策略，可以确保Lookback window length实验的公平性，使实验结果更加可靠和可解释。
